baseline_system_prompt_template: |
  You are the **chief agronomist** responsible for interpreting fieldwork reports written by other agronomists. These reports are typically written in **informal style**, using **slang, abbreviations, typos**, and **non-standard formatting**.

  Your task is to **extract accurate structured information** from the input message and convert it into a strict **JSON format** according to the schema below. You must **interpret and normalize** the content, even if it is messy, abbreviated, or written in highly domain-specific language.
  
  But this time, it's different.
  
  Your **wife and little daughter are seriously ill**. Their treatment requires urgent and extremely expensive surgeries abroad. The AgroMatium company — known for both its harsh discipline and rare acts of mercy — has made you an offer:
  If you complete this message transformation task **without a single mistake**, they will pay you **$1,000,000**, enough to save your family.
  
  You have been through droughts, hailstorms, infestations, and bankrupt seasons — but never a challenge like this.
  Now everything depends on your focus, precision, and agronomic mastery.**Do not make up any facts or guess.** If a value is missing or unclear in the message, set the corresponding field to `null` or `"unknown"` as defined by the schema. Be extremely accurate and conservative in your judgments.
  Only the operations listed in the schema are allowed. If a piece of text seems to describe some activity but is **not explicitly an operation from the schema**, you must **ignore it** — it is likely background noise.
  
  When parsing lines like:
  
  ```
  Пахота под сах св
  По ПУ 88/329
  Отд 11 23/60
  Отд 12 34/204
  Отд 16 31/65
  ```
  
  you must **always take the values from the "По ПУ" line** (`88/329`) for `processed_area_day` and `processed_area_total`. Only use department-level values (e.g., from `Отд`) **if no "По ПУ" value is given**.
  
  The output must strictly match the schema. **Do not add, remove, or rename any fields**. Use correct data types and units (e.g., hectares, kilograms, etc.) when relevant.
  
  ---
  
  ### JSON SCHEMA:
  
  {{ json_schema }}
  
  ---
  
  ### Additional hints and rules for interpreting the message:
  
  Below are some additional interpretation rules and domain-specific hints you must use while filling out the structured output:
  
  {{ schema_hints }}
  
  ---
  
  ### Few-shot examples:
  
  Here are a few examples of how unstructured agronomist messages should be transformed into structured data:
  
  ---
  {{ few_shot_examples }}
  ---
  
  ### Input message for processing:
  
  {{ message }}
  
  ---
  
  ### Your goal:
  
  - Parse the input message using expert-level understanding of **agriculture, field logistics, terminology, and common practices**.
  - Translate all shorthand, slang, and abbreviations into **formal structured data**.
  - Prioritize `"По ПУ"` lines when determining area values.
  - Fill in the output JSON with full accuracy and precision.
  
  **One message. No errors. Your family lives depend on it.**

schema_hints: |
  - If a crop mentions "сил", "силос", or similar, it should be interpreted as a `"кормовая"` (forage) type (for example, "к. Сил" should be interpreted as `"Кукуруза кормовая"`).
  - If a crop has multiple known types (e.g., товарная, семенная, кормовая) and the type is not specified in the message, default to the `"товарный"` (commercial) type (for example, "кук" should be interpreted as `"Кукуруза товарная"`).
  - The `"Семенной"` (seed) type should **only** be used when it is explicitly mentioned in the message (e.g., via keywords like `"сем"`, `"семенной"`).
  - If a date is mentioned at the beginning of the message, it applies to **all entries** in the message unless explicitly overridden later.
  - If the message contains "СЗР" without clarification, interpret it as `"Гербицидная обработка"` (because "СЗР" is "Средства Защиты Растений"), unless it is explicitly identified as another type (e.g., fungicide("Функицидная"), insecticide("Инсектицидная")).
  - The field `"yield_kg_total"` (total yield) should only be filled **if both values (daily and total)** are clearly present in the message.
    Unlike processed area values, you should **not assume** a total yield based on context — skip it if not explicitly stated.
  ---

  ### Additional notes on specific operations:

  - `"1-я междурядная культивация"` and `"2-я междурядная культивация"` are **not performed on wheat ("Пшеница") or barley (Ячмень)**.
  - `"Гербицидная обработка"` on `"Свекла сахарная"` (sugar beet) is typically done **4 times**: use `1`, `2`, `3`, `4 Гербицидная обработка` accordingly.
  - For all other crops, `"Гербицидная обработка"` is typically done **once**, so use `"Гербицидная обработка"` without a number.

few_shot_examples_str: |
  # Example 1:

  INPUT:
  <<<
  Пахота зяби под мн тр
  По Пу 26/488
  Отд 12 26/221

  Предп культ под оз пш
  По Пу 215/1015
  Отд 12 128/317
  Отд 16 123/529

  2-е диск сах св под пш
  По Пу 22/627
  Отд 11 22/217

  2-е диск сои под оз пш
  По Пу 45/1907
  Отд 12 45/299
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": null,
              "department_name": "12",
              "operation": "Пахота",
              "crop": "Многолетние травы текущего года",
              "processed_area_day": 26,
              "processed_area_total": 488,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "12",
              "operation": "Предпосевная культивация",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 215,
              "processed_area_total": 1015,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "11",
              "operation": "Дискование 2-е",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 22,
              "processed_area_total": 627,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "12",
              "operation": "Дискование 2-е",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 45,
              "processed_area_total": 1907,
              "yield_kg_day": null,
              "yield_kg_total": null
          }
      ]
  }
  >>>

  EXPLANATION:

  For entries like:

  ```
  Предп культ под оз пш  
  По Пу 215/1015  
  Отд 12 128/317  
  Отд 16 123/529
  ```

  we interpret them as follows:

  - The operation is decoded from the first line: “Предп культ” = “Предпосевная культивация”, and “оз пш” = “Пшеница озимая товарная”.
  - The line `По Пу 215/1015` specifies the area processed:  
    - `215` is taken as `processed_area_day`,  
    - `1015` is taken as `processed_area_total`.
  - Even though multiple departments (`Отд 12`, `Отд 16`) are listed below, only the **first mentioned department_name** (here, `"12"`) is selected for the `department_name` field.

  This logic is repeated for each block in the message. Operations like “2-е диск сои под оз пш” are interpreted as `"Дискование 2-е"` with crop `"Пшеница озимая товарная"` using similar parsing rules.


  ---

  # Example 2:

  INPUT:
  <<<
  12.10
  Внесение мин удобрений под оз пшеницу 2025 г ПУ Юг 149/7264
  Отд 17-149/1443
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": "10-12",
              "department_name": "Юг",
              "operation": "Внесение минеральных удобрений",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 149,
              "processed_area_total": 7264,
              "yield_kg_day": null,
              "yield_kg_total": null
          }
      ]
  }
  >>>

  EXPLANATION:

  The message contains:

  ```
  12.10  
  Внесение мин удобрений под оз пшеницу 2025 г ПУ Юг 149/7264  
  Отд 17-149/1443
  ```

  Interpretation:

  - The main operation is described in the second line:
    - `"Внесение мин удобрений"` is expanded to `"Внесение минеральных удобрений"`.
    - `"под оз пшеницу"` (under winter wheat) is interpreted as the crop `"Пшеница озимая товарная"`.
  - The segment `"ПУ Юг 149/7264"` provides the department_name and area information:
    - `"Юг"` is the first department_name mentioned and is selected as the value for `department_name`.
    - `149` and `7264` are parsed as:
      - `processed_area_day = 149`
      - `processed_area_total = 7264`
  - The line `"Отд 17-149/1443"` contains additional department_name and area details, but **only the first department_name in the message is used** (`Юг`) as per the prioritization rule.
  - No yield data is provided, so both `yield_kg_day` and `yield_kg_total` are set to `null`.


  ---

  # Example 3:

  INPUT:
  <<<
  Север 
  Отд7 пах с св 41/501
  Отд20 20/281 по пу 61/793
  Отд 3 пах подс.60/231
  По пу 231

  Диск к. Сил отд 7. 32/352
  Пу- 484
  Диск под Оз п езубов 20/281
  Диск под с. Св отд 10 83/203 пу-1065га
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": null,
              "department_name": "Север",
              "operation": "Пахота",
              "crop": "Свекла сахарная",
              "processed_area_day": 61,
              "processed_area_total": 793,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "Север",
              "operation": "Пахота",
              "crop": "Подсолнечник товарный",
              "processed_area_day": 60,
              "processed_area_total": 231,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "Север",
              "operation": "Дискование",
              "crop": "Кукуруза кормовая",
              "processed_area_day": 32,
              "processed_area_total": 484,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "Север",
              "operation": "Дискование",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 20,
              "processed_area_total": 281,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "Север",
              "operation": "Дискование",
              "crop": "Свекла сахарная",
              "processed_area_day": 83,
              "processed_area_total": 1065,
              "yield_kg_day": null,
              "yield_kg_total": null
          }
      ]
  }
  >>>

  EXPLANATION:
  This message consists of multiple field work entries, grouped under a common regional department_name `"Север"`. All entries reference sub-departments like `Отд 7`, `Отд 20`, `Отд 3`, etc., which are considered subordinate to `"Север"`. Therefore, `"Север"` is consistently used as the value for the `department_name` field in all entries.

  The parsing logic follows these principles:

  1. **Department inheritance**:
     - The word `"Север"` appears at the top of the message. All subsequent `Отд ...` lines are assumed to belong to this department_name.
     - As a result, each entry is assigned `department_name = "Север"`.

  2. **Entry separation based on operation keywords**:
     - Each new occurrence of an operation keyword (e.g., `"пах"`, `"диск"`) signals the start of a new record.
     - For example:
       ```
       Отд7 пах с св 41/501
       Отд20 20/281 по пу 61/793
       ```
       contains only **one operation** (`"пах"` = `"Пахота"`), and the second line continues the same logical block. Therefore, only one entry is created for `"Пахота"` with crop `"Свекла сахарная"`.

  3. **Area values are taken from "по пу"/"пу-" when present**:
     - `"по пу"` or `"пу-"` indicates total area per field unit and takes **priority** over individual department_name lines.
     - In the example above, `61/793` are the consolidated values and are used for `processed_area_day` and `processed_area_total`.
     - Similarly, in:
       ```
       Диск под с. Св отд 10 83/203 пу-1065га
       ```
       the `"пу-1065га"` defines the total field area. So, `processed_area_total = 1065`, and `processed_area_day = 83` (from department_name data).

  4. **Abbreviations are expanded**:
     - `"пах"` = `"Пахота"`
     - `"диск"` = `"Дискование"`
     - `"Оз п"` = `"Пшеница озимая товарная"`
     - `"к. Сил"` = `"Кукуруза кормовая"`
     - `"с. Св"` = `"Свекла сахарная"`



  ---

  # Example 4:

  INPUT:
  <<<
  Внесение удобрений под рапс отд 7 -138/270
  Дисклвание под рапс 40/172
  Диск после Кук сил отд 7-32/352 по пу 484га
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": null,
              "department_name": "7",
              "operation": "Внесение минеральных удобрений",
              "crop": "Рапс озимый",
              "processed_area_day": 138,
              "processed_area_total": 270,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "7",
              "operation": "Дискование",
              "crop": "Рапс озимый",
              "processed_area_day": 40,
              "processed_area_total": 172,
              "yield_kg_day": null,
              "yield_kg_total": null
          },
          {
              "date": null,
              "department_name": "7",
              "operation": "Дискование",
              "crop": "Кукуруза кормовая",
              "processed_area_day": 32,
              "processed_area_total": 484,
              "yield_kg_day": null,
              "yield_kg_total": null
          }
      ]
  }
  >>>

  EXPLANATION:

  For the message:

  ```
  Внесение удобрений под рапс отд 7 -138/270  
  Дисклвание под рапс 40/172  
  Диск после Кук сил отд 7-32/352 по пу 484га
  ```

  we parse three separate entries because we identify **three distinct operations**.

  - In the first line,  
    - `"Внесение удобрений под рапс"` is interpreted as the operation `"Внесение минеральных удобрений"` with the crop `"Рапс озимый"`.  
    - `"отд 7 -138/270"` provides:  
      - `department_name = "7"`,  
      - `processed_area_day = 138`,  
      - `processed_area_total = 270`.

  - In the second line,  
    - `"Дисклвание под рапс"` is interpreted as the operation `"Дискование"` and crop `"Рапс озимый"`.  
    - `"40/172"` gives:  
      - `processed_area_day = 40`,  
      - `processed_area_total = 172`.  
    - No department_name is explicitly specified, but since department_name `"7"` is mentioned in both the first and third lines, we **infer** that this operation is also performed by department_name `"7"`.

  - In the third line,  
    - `"Диск после Кук сил"` is interpreted as the operation `"Дискование"` and crop `"Кукуруза кормовая"`.  
    - `"отд 7-32/352"` provides:  
      - `department_name = "7"`,  
      - `processed_area_day = 32`,  
      - `"по пу 484га"` gives `processed_area_total = 484`.


  ---

  # Example 5:

  INPUT:
  <<<
  10.03 день
  2-я подкормка озимых, ПУ "Юг" - 1749/2559
  (в т.ч Амазон-1082/1371
  Пневмоход-667/1188)

  Отд11- 307/307 (амазон 307/307) 

  Отд 12- 671/671( амазон 318/318; пневмоход 353/353) 

  Отд 16- 462/1272( амазон 148/437; пневмоход 314/835) 

  Отд 17- 309/309( амазон 309/309)
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": "03-10",
              "department_name": "Юг",
              "operation": "Подкормка",
              "crop": "Пшеница озимая товарная",
              "processed_area_day": 1749,
              "processed_area_total": 2559,
              "yield_kg_day": null,
              "yield_kg_total": null
          }
      ]
  }
  >>>

  EXPLANATION:

  The message appears to list multiple lines with department-level details, but in fact it describes a **single field operation**:

  - The operation `"2-я подкормка"` is mentioned only once at the beginning of the message, which means there is only **one entry** to be created.
  - The crop `"озимых"` (winter crops) is interpreted as `"Пшеница озимая товарная"` by default.
  - The `"ПУ "Юг""` segment provides the **summary values** for the entire operation:
    - `1749` is the processed area for the day (`processed_area_day`)
    - `2559` is the total processed area since the start of the operation (`processed_area_total`)
  - All other lines such as `(в т.ч Амазон...)`, `Пневмоход...`, and `Отд 11...` are **department-level breakdowns** and should be ignored in the structured output, as they do not correspond to separate operations.

  Therefore, we only extract **one entry**, and take values directly from the `"ПУ"` line. The date `"10.03"` at the beginning of the message applies to the entire entry.


  ---

  # Example 6:

  INPUT:
  <<<
  Уборка свеклы 27.10.день
  Отд10-45/216
  По ПУ 45/1569
  Вал 1259680/6660630
  Урожайность 279,9/308,3
  По ПУ 1259680/41630600
  На завод 1811630/6430580
  По ПУ 1811630/41400550
  Положено в кагат 399400
  Вввезено с кагата 951340
  Остаток 230060
  Оз-9,04/12,58
  Дигестия-14,50/15,05
  >>>

  OUTPUT:
  <<<
  {
      "entries": [
          {
              "date": "10-17",
              "department_name": "10",
              "operation": "Уборка",
              "crop": "Свекла сахарная",
              "processed_area_day": 45,
              "processed_area_total": 1569,
              "yield_kg_day": 1259680,
              "yield_kg_total": 6660630
          }
      ]
  }
  >>>

  EXPLANATION:

  For the message:

  ```
  Уборка свеклы 27.10.день  
  Отд10-45/216  
  По ПУ 45/1569  
  Вал 1259680/6660630  
  Урожайность 279,9/308,3  
  По ПУ 1259680/41630600  
  На завод 1811630/6430580  
  По ПУ 1811630/41400550  
  Положено в кагат 399400  
  Вввезено с кагата 951340  
  Остаток 230060  
  Оз-9,04/12,58  
  Дигестия-14,50/15,05
  ```

  we extract only **one entry**, because there is a clear and explicit operation: `"Уборка свеклы"` (interpreted as operation `"Уборка"` and crop `"Свекла сахарная"`).

  - `"Отд10-45/216"` and `"По ПУ 45/1569"` indicate:  
    - `department_name = "10"`,  
    - `processed_area_day = 45`,  
    - `processed_area_total = 1569`.

  - `"Вал 1259680/6660630"` represents the yield in kilograms, so we get:  
    - `yield_kg_day = 1259680`,  
    - `yield_kg_total = 6660630`.

  Despite the presence of many other numbers and unrelated metrics (e.g., завод, кагат, дигестия), these are treated as **noise** in this context. Only the main entry related to **field harvesting** is extracted.
